2025-08-02 12:08:12,706 - INFO - üöÄ Clean BLIP3-o CLIP Reproduction Training
2025-08-02 12:08:12,707 - INFO - ============================================================
2025-08-02 12:08:12,707 - INFO - üìã Task: Reproduce CLIP embeddings from EVA embeddings
2025-08-02 12:08:12,707 - INFO - üß† Model: BLIP3-o DiT with 3D RoPE and Sandwich Normalization
2025-08-02 12:08:12,707 - INFO - üåä Method: Rectified Flow Matching
2025-08-02 12:08:12,707 - INFO - üéØ Target: CLIP embeddings [B, N, 1024]
2025-08-02 12:08:12,707 - INFO - üéÆ Conditioning: EVA embeddings [B, N, 4096]
2025-08-02 12:08:12,707 - INFO - ============================================================
2025-08-02 12:08:12,711 - INFO - Configuration:
2025-08-02 12:08:12,711 - INFO -   Model size: base
2025-08-02 12:08:12,711 - INFO -   Training mode: patch_only
2025-08-02 12:08:12,711 - INFO -   Embeddings dir: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-02 12:08:12,711 - INFO -   Output dir: ./checkpoints/blip3o_clean_20250802_120809
2025-08-02 12:08:12,711 - INFO -   Learning rate: 0.0003
2025-08-02 12:08:12,711 - INFO -   Batch size: 128
2025-08-02 12:08:12,711 - INFO -   Epochs: 20
2025-08-02 12:08:12,711 - INFO -   Max shards: 30
2025-08-02 12:08:13,179 - INFO - Using GPU: NVIDIA H100
2025-08-02 12:08:13,179 - INFO - GPU Memory: 100.0 GB
2025-08-02 12:08:13,179 - INFO - PyTorch version: 2.7.1+cu126
2025-08-02 12:08:13,179 - INFO - ‚úÖ Environment check passed
2025-08-02 12:08:13,179 - INFO - ‚úÖ Output directory ready: checkpoints/blip3o_clean_20250802_120809
2025-08-02 12:08:13,179 - INFO - üèóÔ∏è Creating model...
2025-08-02 12:08:22,999 - INFO - ‚úÖ CLIP DiT model loaded successfully
2025-08-02 12:08:23,007 - INFO - ‚úÖ Flow matching loss loaded successfully
2025-08-02 12:08:23,729 - INFO - ‚úÖ CLIP trainer loaded successfully
2025-08-02 12:08:23,733 - INFO - ‚úÖ CLIP datasets loaded successfully
2025-08-02 12:08:23,738 - INFO - ‚úÖ Configuration loaded successfully
2025-08-02 12:08:23,738 - INFO - üéâ All CLIP reproduction components loaded successfully!
2025-08-02 12:08:23,738 - INFO - üéâ Clean BLIP3-o CLIP reproduction modules fully initialized!
2025-08-02 12:08:23,738 - INFO - üéØ Ready for EVA ‚Üí CLIP reproduction training
2025-08-02 12:08:23,738 - INFO - ‚úÖ Configuration validation passed
2025-08-02 12:08:25,569 - INFO - ‚úÖ Stable initialization applied with depth scale: 0.2887
2025-08-02 12:08:25,570 - INFO - ‚úÖ Updated BLIP3-o CLIP DiT model initialized: 221,055,232 parameters
2025-08-02 12:08:25,570 - INFO -   ‚úÖ Fixed inference implemented
2025-08-02 12:08:25,570 - INFO -   ‚úÖ Stable initialization applied
2025-08-02 12:08:25,805 - INFO - Model created with 221,055,232 parameters
2025-08-02 12:08:25,805 - INFO -   Model size: base
2025-08-02 12:08:25,805 - INFO -   Training mode: patch_only
2025-08-02 12:08:25,805 - INFO -   3D RoPE: Enabled
2025-08-02 12:08:25,805 - INFO -   Sandwich Norm: Enabled
2025-08-02 12:08:25,805 - INFO - üåä Creating loss function...
2025-08-02 12:08:25,805 - INFO - Clean CLIP Flow Matching Loss initialized:
2025-08-02 12:08:25,805 - INFO -   Prediction type: velocity
2025-08-02 12:08:25,805 - INFO -   Flow type: rectified
2025-08-02 12:08:25,805 - INFO - Loss function created:
2025-08-02 12:08:25,805 - INFO -   Prediction type: velocity
2025-08-02 12:08:25,805 - INFO -   Flow type: rectified
2025-08-02 12:08:25,805 - INFO - üìä Creating dataloaders...
2025-08-02 12:08:25,805 - INFO - Loading embeddings from: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-02 12:08:25,806 - INFO - Found 35 .pkl files in embeddings directory
2025-08-02 12:08:25,806 - INFO - Creating clean CLIP reproduction dataloaders:
2025-08-02 12:08:25,806 - INFO -   Target: CLIP embeddings [B, N, 1024]
2025-08-02 12:08:25,806 - INFO -   Conditioning: EVA embeddings [B, N, 4096]
2025-08-02 12:08:25,807 - INFO -   Noise: Standard Gaussian
2025-08-02 12:08:25,822 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-02 12:08:25,822 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-02 12:08:25,829 - INFO - Prepared 30 shard files
2025-08-02 12:08:25,829 - INFO - Using manifest for length estimation: 78,285 samples
2025-08-02 12:08:25,829 - INFO - Clean CLIP Reproduction Dataset initialized:
2025-08-02 12:08:25,829 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-02 12:08:25,829 - INFO -   Mode: patch_only (256 tokens)
2025-08-02 12:08:25,829 - INFO -   TARGET: CLIP embeddings [B, N, 1024]
2025-08-02 12:08:25,829 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096]
2025-08-02 12:08:25,829 - INFO -   Shards: 30
2025-08-02 12:08:25,830 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-02 12:08:25,830 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-02 12:08:25,830 - INFO - Prepared 30 shard files
2025-08-02 12:08:25,830 - INFO - Using manifest for length estimation: 78,285 samples
2025-08-02 12:08:25,830 - INFO - Clean CLIP Reproduction Dataset initialized:
2025-08-02 12:08:25,830 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-02 12:08:25,830 - INFO -   Mode: patch_only (256 tokens)
2025-08-02 12:08:25,830 - INFO -   TARGET: CLIP embeddings [B, N, 1024]
2025-08-02 12:08:25,830 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096]
2025-08-02 12:08:25,830 - INFO -   Shards: 30
2025-08-02 12:08:25,830 - INFO - Clean CLIP reproduction dataloaders created successfully
2025-08-02 12:08:25,830 - INFO -   Training dataset length: 78,285
2025-08-02 12:08:25,830 - INFO -   Evaluation dataset length: 78,285
2025-08-02 12:08:25,830 - INFO - Dataloaders created successfully:
2025-08-02 12:08:25,830 - INFO -   Training mode: patch_only
2025-08-02 12:08:25,830 - INFO -   Batch size: 128
2025-08-02 12:08:25,830 - INFO -   Max shards: 30
2025-08-02 12:08:30,771 - INFO - ‚úÖ Dataloader test successful:
2025-08-02 12:08:30,772 - INFO -   Batch size: 128
2025-08-02 12:08:30,772 - INFO -   CLIP embeddings shape: torch.Size([128, 256, 1024])
2025-08-02 12:08:30,772 - INFO -   EVA embeddings shape: torch.Size([128, 256, 4096])
2025-08-02 12:08:30,772 - INFO - üèÉ Creating trainer...
2025-08-02 12:08:30,776 - INFO - Got exact dataloader length: 611
2025-08-02 12:08:30,777 - INFO - Optimizer and scheduler setup complete
2025-08-02 12:08:30,777 - INFO -   Total estimated steps: 12220
2025-08-02 12:08:30,777 - INFO -   Warmup steps: 500
2025-08-02 12:08:32,169 - INFO - ‚úÖ WandB initialized: blip3o-clip-clean
2025-08-02 12:08:32,169 - INFO -    Run ID: w11y8w2t
2025-08-02 12:08:32,169 - INFO - FIXED BLIP3-o CLIP Trainer initialized
2025-08-02 12:08:32,169 - INFO -   Device: cuda
2025-08-02 12:08:32,170 - INFO -   Parameters: 221,055,232
2025-08-02 12:08:32,170 - INFO -   Checkpoint max size: 2.0 GB
2025-08-02 12:08:32,170 - INFO -   Checkpoint compression: True
2025-08-02 12:08:32,171 - INFO - Trainer created successfully:
2025-08-02 12:08:32,171 - INFO -   Evaluation: Every 800 steps
2025-08-02 12:08:32,171 - INFO -   WandB enabled: True
2025-08-02 12:08:32,171 - INFO - üíæ Saving experiment configuration...
2025-08-02 12:08:32,172 - INFO - ‚úÖ Configuration saved to checkpoints/blip3o_clean_20250802_120809/experiment_config.json
2025-08-02 12:08:32,173 - INFO - 
üöÄ Starting clean BLIP3-o training...
2025-08-02 12:08:32,173 - INFO - ============================================================
2025-08-02 12:08:32,173 - INFO - üöÄ Starting FIXED BLIP3-o training...
2025-08-02 12:08:32,174 - INFO -   Model parameters: 221,055,232
2025-08-02 12:08:32,175 - INFO - Starting epoch 1/20
2025-08-02 12:08:47,521 - INFO - Step 10: Loss=1.885033, VelSim=0.2084, GradNorm=42896.680, LR=3.54e-05
2025-08-02 12:08:57,262 - INFO - Step 20: Loss=1.865528, VelSim=0.2348, GradNorm=38675.040, LR=4.08e-05
2025-08-02 12:09:11,466 - INFO - Step 30: Loss=1.845500, VelSim=0.2579, GradNorm=37709.662, LR=4.62e-05
2025-08-02 12:09:21,091 - INFO - Step 40: Loss=1.842558, VelSim=0.2863, GradNorm=185941.976, LR=5.16e-05
2025-08-02 12:09:35,986 - INFO - Step 50: Loss=1.787947, VelSim=0.3173, GradNorm=39391.751, LR=5.70e-05
2025-08-02 12:09:45,618 - INFO - Step 60: Loss=1.716543, VelSim=0.3408, GradNorm=35152.448, LR=6.24e-05
2025-08-02 12:10:00,660 - INFO - Step 70: Loss=1.710677, VelSim=0.3554, GradNorm=24767.028, LR=6.78e-05
2025-08-02 12:10:10,335 - INFO - Step 80: Loss=1.700550, VelSim=0.3615, GradNorm=142866.837, LR=7.32e-05
