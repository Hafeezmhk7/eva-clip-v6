2025-08-01 03:12:52,359 - INFO - ðŸ”§ FIXED: CLIP Reproduction Training with NO NOISE SCALING
2025-08-01 03:12:52,361 - INFO - ==========================================================================================
2025-08-01 03:12:52,361 - INFO - ðŸ”§ KEY CHANGE:
2025-08-01 03:12:52,361 - INFO -   ðŸš« ALL NOISE SCALING DISABLED
2025-08-01 03:12:52,361 - INFO -   âœ… Using standard Gaussian noise (mean=0, std=1) everywhere
2025-08-01 03:12:52,361 - INFO -   âœ… Consistent noise distribution between training and inference
2025-08-01 03:12:52,361 - INFO -   âœ… Model learns to work with natural noise scale
2025-08-01 03:12:52,361 - INFO - ==========================================================================================
2025-08-01 03:12:52,361 - INFO - EXPERIMENT DETAILS:
2025-08-01 03:12:52,362 - INFO -   ðŸ“‹ Task: Reproduce clean CLIP embeddings from EVA embeddings
2025-08-01 03:12:52,362 - INFO -   ðŸ§  Model: BLIP3-o DiT with consistent noise handling
2025-08-01 03:12:52,362 - INFO -   ðŸŽ¯ Target: CLIP embeddings [B, N, 1024] - RAW
2025-08-01 03:12:52,362 - INFO -   ðŸŽ® Conditioning: EVA embeddings [B, N, 4096] - RAW
2025-08-01 03:12:52,362 - INFO -   ðŸŒŠ Method: Rectified Flow Matching with standard Gaussian noise
2025-08-01 03:12:52,362 - INFO -   ðŸŽ² Noise: Standard Gaussian (NO SCALING) in training and inference
2025-08-01 03:12:52,362 - INFO - ==========================================================================================
2025-08-01 03:12:52,362 - INFO - EXPERIMENT DETAILS:
2025-08-01 03:12:52,362 - INFO -   ðŸ“‹ Task: Reproduce clean CLIP embeddings from EVA embeddings
2025-08-01 03:12:52,362 - INFO -   ðŸ§  Model: FIXED BLIP3-o DiT with NO unwanted normalization
2025-08-01 03:12:52,362 - INFO -   ðŸŽ¯ Target: CLIP embeddings [B, N, 1024] - RAW (no normalization)
2025-08-01 03:12:52,362 - INFO -   ðŸŽ® Conditioning: EVA embeddings [B, N, 4096] - RAW (no normalization)
2025-08-01 03:12:52,362 - INFO -   ðŸŒŠ Method: Rectified Flow Matching in RAW embedding space
2025-08-01 03:12:52,362 - INFO -   ðŸš« Normalization: ONLY for cosine similarity computation
2025-08-01 03:12:52,362 - INFO -   ðŸ“Š Enhanced: Detailed norm tracking and debugging
2025-08-01 03:12:52,363 - INFO - ==========================================================================================
2025-08-01 03:12:52,363 - INFO - Configuration:
2025-08-01 03:12:52,363 - INFO -   Model size: base
2025-08-01 03:12:52,363 - INFO -   Training mode: patch_only
2025-08-01 03:12:52,363 - INFO -   Embeddings dir: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 03:12:52,363 - INFO -   Output dir: ./checkpoints/clip_repro_20250801_031250
2025-08-01 03:12:52,363 - INFO -   Learning rate: 0.0001
2025-08-01 03:12:52,363 - INFO -   Batch size: 8
2025-08-01 03:12:52,363 - INFO -   Epochs: 10
2025-08-01 03:12:52,363 - INFO -   Max shards: 2
2025-08-01 03:12:52,363 - INFO -   ðŸ§ª FIXED OVERFITTING TEST: 20 samples (from eval data)
2025-08-01 03:12:52,363 - INFO -   Debug mode: False
2025-08-01 03:12:52,363 - INFO - ==========================================================================================
2025-08-01 03:12:52,859 - INFO - Using GPU: NVIDIA H100
2025-08-01 03:12:52,859 - INFO - GPU Memory: 100.0 GB
2025-08-01 03:12:52,859 - INFO - ðŸ—ï¸ FIXED BLIP3-o Architecture Configuration:
2025-08-01 03:12:52,859 - INFO -   3D Rotary Position Embedding: âœ… Enabled
2025-08-01 03:12:52,859 - INFO -   Sandwich Normalization: âœ… Enabled
2025-08-01 03:12:52,859 - INFO -   ðŸš« NO unwanted normalization in model
2025-08-01 03:12:56,121 - INFO - âœ… CLIP DiT model loaded from src/modules/models/blip3o_dit.py
2025-08-01 03:12:56,123 - INFO - âœ… Flow matching loss loaded from src/modules/losses/blip3o_fm_loss.py
2025-08-01 03:12:56,972 - INFO - âœ… CLIP trainer loaded from src/modules/trainers/blip3o_trainer.py
2025-08-01 03:12:56,974 - INFO - âœ… CLIP datasets loaded from src/modules/datasets/blip3o_dataset.py
2025-08-01 03:12:56,978 - INFO - âœ… Configuration loaded from src/modules/config/blip3o_config.py
2025-08-01 03:12:56,978 - INFO - ðŸŽ‰ All CLIP reproduction components loaded successfully!
2025-08-01 03:12:56,978 - INFO - ðŸŽ‰ BLIP3-o CLIP reproduction modules fully initialized!
2025-08-01 03:12:56,978 - INFO - ðŸš« Using minimal normalization approach
2025-08-01 03:12:56,978 - INFO - ðŸŽ¯ Ready for EVA â†’ CLIP reproduction training
2025-08-01 03:12:56,978 - INFO - âœ… Imported FIXED model
2025-08-01 03:12:59,000 - INFO - FIXED BLIP3-o CLIP DiT model initialized with 249,339,136 parameters
2025-08-01 03:12:59,001 - INFO -   3D RoPE: True
2025-08-01 03:12:59,001 - INFO -   Sandwich Normalization: True
2025-08-01 03:12:59,001 - INFO -   Grid size: 16x16
2025-08-01 03:12:59,001 - INFO -   Hidden size: 768
2025-08-01 03:12:59,001 - INFO -   CLIP size: 1024
2025-08-01 03:12:59,001 - INFO -   ðŸš« NO unwanted normalization in input/output projections
2025-08-01 03:12:59,001 - INFO -   ðŸŽ² Standard Gaussian noise for generation (NO SCALING)
2025-08-01 03:12:59,245 - INFO - FIXED model created with 249,339,136 parameters
2025-08-01 03:12:59,246 - INFO - Model moved to cuda
2025-08-01 03:12:59,246 - INFO - âœ… Imported FIXED loss function
2025-08-01 03:12:59,246 - INFO - FIXED CLIP Flow Matching Loss initialized (NO NOISE SCALING):
2025-08-01 03:12:59,246 - INFO -   Prediction type: velocity
2025-08-01 03:12:59,246 - INFO -   Flow type: rectified
2025-08-01 03:12:59,246 - INFO -   Noise scaling: DISABLED (always standard Gaussian)
2025-08-01 03:12:59,246 - INFO -   Debug mode: False
2025-08-01 03:12:59,246 - INFO -   ðŸŽ² Noise: Standard Gaussian (mean=0, std=1) everywhere
2025-08-01 03:12:59,246 - INFO - FIXED loss function created (NO NOISE SCALING):
2025-08-01 03:12:59,246 - INFO -   Prediction type: velocity
2025-08-01 03:12:59,246 - INFO -   Flow type: rectified
2025-08-01 03:12:59,246 - INFO -   Noise scaling: DISABLED (standard Gaussian)
2025-08-01 03:12:59,246 - INFO -   ðŸš« NO noise scaling applied anywhere
2025-08-01 03:12:59,246 - INFO - âœ… Imported FIXED dataset
2025-08-01 03:12:59,246 - INFO - FIXED: Creating CLIP reproduction dataloaders (NO NOISE SCALING):
2025-08-01 03:12:59,246 - INFO -   Target: CLIP embeddings [B, N, 1024] - RAW (no normalization)
2025-08-01 03:12:59,246 - INFO -   Conditioning: EVA embeddings [B, N, 4096] - RAW (no normalization)
2025-08-01 03:12:59,246 - INFO -   ðŸš« Normalization: DISABLED (forced)
2025-08-01 03:12:59,246 - INFO -   ðŸŽ² Noise: Standard Gaussian (NO SCALING)
2025-08-01 03:12:59,246 - INFO -   Collect statistics: False
2025-08-01 03:12:59,247 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-01 03:12:59,247 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-01 03:12:59,248 - INFO - Prepared 2 shard files
2025-08-01 03:12:59,248 - INFO - Using manifest for length estimation: 5,219 samples
2025-08-01 03:12:59,248 - INFO - FIXED CLIP Reproduction Dataset initialized:
2025-08-01 03:12:59,248 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 03:12:59,248 - INFO -   Mode: patch_only (256 tokens)
2025-08-01 03:12:59,248 - INFO -   TARGET: CLIP embeddings [B, N, 1024] - RAW (no normalization)
2025-08-01 03:12:59,248 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096] - RAW (no normalization)
2025-08-01 03:12:59,248 - INFO -   ðŸš« Normalization: DISABLED (raw embedding space)
2025-08-01 03:12:59,248 - INFO -   Shards: 2
2025-08-01 03:12:59,248 - INFO -   Statistics collection: False
2025-08-01 03:12:59,248 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-01 03:12:59,249 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-01 03:12:59,249 - INFO - Prepared 2 shard files
2025-08-01 03:12:59,249 - INFO - Using manifest for length estimation: 5,219 samples
2025-08-01 03:12:59,249 - INFO - FIXED CLIP Reproduction Dataset initialized:
2025-08-01 03:12:59,249 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 03:12:59,249 - INFO -   Mode: patch_only (256 tokens)
2025-08-01 03:12:59,249 - INFO -   TARGET: CLIP embeddings [B, N, 1024] - RAW (no normalization)
2025-08-01 03:12:59,249 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096] - RAW (no normalization)
2025-08-01 03:12:59,249 - INFO -   ðŸš« Normalization: DISABLED (raw embedding space)
2025-08-01 03:12:59,249 - INFO -   Shards: 2
2025-08-01 03:12:59,249 - INFO -   Statistics collection: False
2025-08-01 03:12:59,249 - INFO - FIXED: CLIP reproduction dataloaders created successfully
2025-08-01 03:12:59,249 - INFO -   Training dataset length: 5,219
2025-08-01 03:12:59,249 - INFO -   Evaluation dataset length: 5,219
2025-08-01 03:12:59,249 - INFO -   ðŸš« NO normalization applied in either dataset
2025-08-01 03:12:59,249 - INFO -   ðŸŽ² Standard Gaussian noise (NO SCALING) in collate function
2025-08-01 03:12:59,249 - INFO -   Consistent processing: âœ…
2025-08-01 03:12:59,249 - INFO - FIXED dataloaders created:
2025-08-01 03:12:59,249 - INFO -   ðŸš« Normalization: DISABLED (forced)
2025-08-01 03:12:59,249 - INFO -   Statistics collection: Disabled
2025-08-01 03:12:59,249 - INFO -   Max shards: 2
2025-08-01 03:12:59,249 - INFO -   Raw embedding space: âœ…
2025-08-01 03:12:59,249 - INFO - âœ… Imported FIXED trainer
2025-08-01 03:12:59,252 - INFO - Got exact dataloader length: 652
2025-08-01 03:12:59,254 - INFO - Optimizer and scheduler setup complete
2025-08-01 03:12:59,254 - INFO -   Total estimated steps: 6520
2025-08-01 03:12:59,254 - INFO -   Warmup steps: 100
2025-08-01 03:12:59,254 - INFO - ðŸ”§ FIXED: Preparing overfitting test with 20 samples from EVAL DATA...
2025-08-01 03:13:03,623 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 03:13:03,668 - INFO - âœ… Using eval_dataloader for overfitting test (consistent with evaluation)
2025-08-01 03:13:03,671 - INFO - âœ… FIXED overfitting test prepared with 8 samples:
2025-08-01 03:13:03,671 - INFO -   Data source: eval_dataloader
2025-08-01 03:13:03,672 - INFO -   Overfit CLIP norm: 25.292
2025-08-01 03:13:03,672 - INFO -   Overfit EVA norm: 42.896
2025-08-01 03:13:03,672 - INFO -   ðŸŽ² Noise: mean=-0.000460, std=1.000469
2025-08-01 03:13:03,672 - INFO -   ðŸŽ² Standard Gaussian: True
2025-08-01 03:13:03,672 - INFO - FIXED BLIP3-o CLIP Trainer initialized (NO NOISE SCALING)
2025-08-01 03:13:03,672 - INFO -   Device: cuda
2025-08-01 03:13:03,672 - INFO -   Learning rate: 0.0001
2025-08-01 03:13:03,672 - INFO -   Epochs: 10
2025-08-01 03:13:03,672 - INFO -   Estimated steps per epoch: 652
2025-08-01 03:13:03,672 - INFO -   Overfit test: 20
2025-08-01 03:13:03,672 - INFO -   Mixed precision: True
2025-08-01 03:13:03,672 - INFO -   WandB logging: False
2025-08-01 03:13:03,672 - INFO -   ðŸŽ² Standard Gaussian noise everywhere (NO SCALING)
2025-08-01 03:13:03,672 - INFO -   ðŸ”§ FIXED: Consistent evaluation and overfitting test
2025-08-01 03:13:03,672 - INFO -   ðŸ“Š FIXED: Enhanced norm tracking enabled
2025-08-01 03:13:03,672 - INFO - FIXED trainer created:
2025-08-01 03:13:03,672 - INFO -   Evaluation: Every 50 steps
2025-08-01 03:13:03,672 - INFO -   Inference steps: 20
2025-08-01 03:13:03,672 - INFO -   WandB enabled: False
2025-08-01 03:13:03,672 - INFO -   ðŸ”§ FIXED: Overfitting test uses same data source as evaluation
2025-08-01 03:13:03,672 - INFO -   ðŸ“Š FIXED: Enhanced norm tracking enabled
2025-08-01 03:13:03,692 - INFO - FIXED configuration saved to checkpoints/clip_repro_20250801_031250/fixed_experiment_config.json
2025-08-01 03:13:03,693 - INFO - 
ðŸ”§ Starting FIXED BLIP3-o training with consistent data...
2025-08-01 03:13:03,693 - INFO - Expected behavior with ALL FIXES:
2025-08-01 03:13:03,693 - INFO -   â€¢ Consistent target norms between training and evaluation
2025-08-01 03:13:03,693 - INFO -   â€¢ Overfitting test should achieve >0.8 similarity (same data as eval)
2025-08-01 03:13:03,693 - INFO -   â€¢ NO unwanted normalization anywhere in the pipeline
2025-08-01 03:13:03,693 - INFO -   â€¢ Raw embedding space training with proper scale learning
2025-08-01 03:13:03,693 - INFO -   â€¢ Enhanced norm tracking shows data distribution
2025-08-01 03:13:03,693 - INFO -   â€¢ Much better norm consistency (target vs generated)
2025-08-01 03:13:03,693 - INFO -   â€¢ Higher cosine similarity due to consistent data and scaling
2025-08-01 03:13:03,693 - INFO -   â€¢ Stable and reproducible evaluation results
2025-08-01 03:13:03,693 - INFO -   â€¢ OVERFITTING TEST: Should achieve >0.8 similarity on 20 samples
2025-08-01 03:13:03,693 - INFO -     âœ… Uses SAME data source as evaluation for consistency
2025-08-01 03:13:03,693 - INFO - 
2025-08-01 03:13:03,693 - INFO - ðŸ”§ FIXED: Starting CLIP reproduction training with NO NOISE SCALING...
2025-08-01 03:13:03,694 - INFO -   Model parameters: 249,339,136
2025-08-01 03:13:03,694 - INFO -   Estimated training steps per epoch: 652
2025-08-01 03:13:03,694 - INFO -   Total estimated training steps: 6520
2025-08-01 03:13:03,694 - INFO -   ðŸŽ² Standard Gaussian noise everywhere (NO SCALING)
2025-08-01 03:13:03,694 - INFO -   ðŸ“Š WandB logging: False
2025-08-01 03:13:03,694 - INFO -   ðŸ”§ FIXED: Overfitting test uses same data source as evaluation
2025-08-01 03:13:03,694 - INFO -   ðŸ“Š FIXED: Enhanced norm tracking + noise statistics enabled
2025-08-01 03:13:03,694 - INFO -   OVERFITTING TEST MODE: Using 8 samples from evaluation data
2025-08-01 03:13:03,696 - INFO - Starting epoch 1/10
2025-08-01 03:13:08,466 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:13:11,642 - INFO - Step 10: Loss=1.845398, VelSim=0.2501 (fair), GradNorm=43970.754, LR=1.90e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=2.329, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:14,476 - INFO - Step 20: Loss=1.808224, VelSim=0.2393 (fair), GradNorm=41090.476, LR=2.80e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=5.779, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:17,306 - INFO - Step 30: Loss=1.779672, VelSim=0.2718 (fair), GradNorm=48008.097, LR=3.70e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=7.075, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:20,141 - INFO - Step 40: Loss=1.742142, VelSim=0.3021 (fair), GradNorm=38370.187, LR=4.60e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=9.109, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:22,975 - INFO - Step 50: Loss=1.688109, VelSim=0.3470 (fair), GradNorm=43333.014, LR=5.50e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=10.717, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:22,977 - INFO - ðŸ“Š NORM ANALYSIS (NO NOISE SCALING):
2025-08-01 03:13:22,977 - INFO -   Training Target Norms: mean=25.292, std=0.000, range=[25.292, 25.292]
2025-08-01 03:13:22,977 - INFO -   Overfit Target Norm: 25.292
2025-08-01 03:13:22,977 - INFO -   ðŸŽ² Noise Stats: avg_mean=-0.000460, avg_std=1.000469
2025-08-01 03:13:22,978 - INFO -   ðŸŽ² Standard Gaussian Rate: 100.0%
2025-08-01 03:13:22,978 - INFO - Running FIXED evaluation at step 50 (NO NOISE SCALING)...
2025-08-01 03:13:27,094 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 03:13:41,624 - INFO - FIXED Evaluation results:
2025-08-01 03:13:41,627 - INFO -   CLIP similarity: 0.1662
2025-08-01 03:13:41,627 - INFO -   Generated norm: 33.929
2025-08-01 03:13:41,627 - INFO -   Target norm: 25.856
2025-08-01 03:13:41,627 - INFO -   Norm ratio: 1.312
2025-08-01 03:13:41,627 - INFO -   Norm consistency: 0.688
2025-08-01 03:13:41,627 - INFO -   ðŸŽ² Standard Gaussian noise: True
2025-08-01 03:13:44,455 - INFO - Step 60: Loss=1.621938, VelSim=0.3831 (fair), GradNorm=49637.227, LR=6.40e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=15.637, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:47,288 - INFO - Step 70: Loss=1.564124, VelSim=0.4140 (fair), GradNorm=35972.082, LR=7.30e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=15.783, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:50,123 - INFO - Step 80: Loss=1.501163, VelSim=0.4426 (fair), GradNorm=59537.251, LR=8.20e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=17.267, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:52,959 - INFO - Step 90: Loss=1.356096, VelSim=0.5121 (good), GradNorm=78103.664, LR=9.10e-05, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=20.856, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:55,803 - INFO - Step 100: Loss=1.116007, VelSim=0.6097 (good), GradNorm=99314.595, LR=1.00e-04, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=23.412, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:13:55,804 - INFO - ðŸ“Š NORM ANALYSIS (NO NOISE SCALING):
2025-08-01 03:13:55,804 - INFO -   Training Target Norms: mean=25.292, std=0.000, range=[25.292, 25.292]
2025-08-01 03:13:55,804 - INFO -   Eval Target Norms: mean=25.856, std=0.564, range=[25.292, 26.420]
2025-08-01 03:13:55,804 - INFO -   Overfit Target Norm: 25.292
2025-08-01 03:13:55,804 - INFO -   ðŸŽ² Noise Stats: avg_mean=-0.000460, avg_std=1.000469
2025-08-01 03:13:55,804 - INFO -   ðŸŽ² Standard Gaussian Rate: 100.0%
2025-08-01 03:13:55,804 - INFO -   Train vs Eval Consistency: âœ… CONSISTENT (diff=0.564)
2025-08-01 03:13:55,804 - INFO - Running FIXED evaluation at step 100 (NO NOISE SCALING)...
2025-08-01 03:13:59,931 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 03:14:14,274 - INFO - FIXED Evaluation results:
2025-08-01 03:14:14,274 - INFO -   CLIP similarity: 0.2238
2025-08-01 03:14:14,274 - INFO -   Generated norm: 36.672
2025-08-01 03:14:14,275 - INFO -   Target norm: 25.856
2025-08-01 03:14:14,275 - INFO -   Norm ratio: 1.418
2025-08-01 03:14:14,275 - INFO -   Norm consistency: 0.582
2025-08-01 03:14:14,275 - INFO -   ðŸŽ² Standard Gaussian noise: True
2025-08-01 03:14:17,068 - INFO - Step 110: Loss=0.853959, VelSim=0.7008 (good), GradNorm=149945.474, LR=1.00e-04, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=29.453, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:14:19,862 - INFO - Step 120: Loss=0.622354, VelSim=0.7855 (good), GradNorm=146655.112, LR=1.00e-04, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=32.177, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:14:22,661 - INFO - Step 130: Loss=0.457678, VelSim=0.8440 (excellent), GradNorm=159398.184, LR=1.00e-04, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=35.108, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:14:25,606 - INFO - Step 140: Loss=0.345436, VelSim=0.8844 (excellent), GradNorm=157907.824, LR=1.00e-04, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=36.379, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:14:27,287 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:14:27,287 - INFO - Epoch 1 completed:
2025-08-01 03:14:27,287 - INFO -   Average loss: 1.315438
2025-08-01 03:14:27,287 - INFO -   Best loss: 0.298474
2025-08-01 03:14:27,287 - INFO -   Best similarity: 0.9011
2025-08-01 03:14:27,287 - INFO -   Steps in epoch: 146
2025-08-01 03:14:27,287 - INFO -   Epoch time: 83.6s
2025-08-01 03:14:27,289 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:14:27,289 - INFO -     Training target norm: 25.292
2025-08-01 03:14:27,289 - INFO -     Eval target norm: 25.856
2025-08-01 03:14:27,289 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:14:27,289 - INFO - Starting epoch 2/10
2025-08-01 03:14:31,342 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:14:31,623 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:14:31,623 - INFO - Epoch 2 completed:
2025-08-01 03:14:31,623 - INFO -   Average loss: 0.295828
2025-08-01 03:14:31,623 - INFO -   Best loss: 0.295828
2025-08-01 03:14:31,623 - INFO -   Best similarity: 0.9022
2025-08-01 03:14:31,623 - INFO -   Steps in epoch: 1
2025-08-01 03:14:31,623 - INFO -   Epoch time: 4.3s
2025-08-01 03:14:31,624 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:14:31,624 - INFO -     Training target norm: 25.292
2025-08-01 03:14:31,624 - INFO -     Eval target norm: 25.856
2025-08-01 03:14:31,624 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:14:31,624 - INFO - Starting epoch 3/10
2025-08-01 03:14:35,654 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:14:35,940 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:14:35,940 - INFO - Epoch 3 completed:
2025-08-01 03:14:35,940 - INFO -   Average loss: 0.287648
2025-08-01 03:14:35,940 - INFO -   Best loss: 0.287648
2025-08-01 03:14:35,940 - INFO -   Best similarity: 0.9049
2025-08-01 03:14:35,940 - INFO -   Steps in epoch: 1
2025-08-01 03:14:35,940 - INFO -   Epoch time: 4.3s
2025-08-01 03:14:35,940 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:14:35,941 - INFO -     Training target norm: 25.292
2025-08-01 03:14:35,941 - INFO -     Eval target norm: 25.856
2025-08-01 03:14:35,941 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:14:35,941 - INFO - Starting epoch 4/10
2025-08-01 03:14:39,971 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:14:40,256 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:14:40,256 - INFO - Epoch 4 completed:
2025-08-01 03:14:40,257 - INFO -   Average loss: 0.273180
2025-08-01 03:14:40,257 - INFO -   Best loss: 0.273180
2025-08-01 03:14:40,257 - INFO -   Best similarity: 0.9100
2025-08-01 03:14:40,257 - INFO -   Steps in epoch: 1
2025-08-01 03:14:40,257 - INFO -   Epoch time: 4.3s
2025-08-01 03:14:40,257 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:14:40,257 - INFO -     Training target norm: 25.292
2025-08-01 03:14:40,257 - INFO -     Eval target norm: 25.856
2025-08-01 03:14:40,257 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:14:40,257 - INFO - Starting epoch 5/10
2025-08-01 03:14:44,281 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:14:44,563 - INFO - Step 150: Loss=0.261455, VelSim=0.9144 (excellent), GradNorm=135702.364, LR=1.00e-04, Noise=Î¼-0.000Ïƒ1.000âœ…, PredNorm=37.141, TargetNorm=41.366, BatchCLIPNorm=25.292 [OVERFIT TEST]
2025-08-01 03:14:44,564 - INFO - ðŸ“Š NORM ANALYSIS (NO NOISE SCALING):
2025-08-01 03:14:44,564 - INFO -   Training Target Norms: mean=25.292, std=0.000, range=[25.292, 25.292]
2025-08-01 03:14:44,565 - INFO -   Eval Target Norms: mean=25.856, std=0.564, range=[25.292, 26.420]
2025-08-01 03:14:44,565 - INFO -   Overfit Target Norm: 25.292
2025-08-01 03:14:44,565 - INFO -   ðŸŽ² Noise Stats: avg_mean=-0.000460, avg_std=1.000469
2025-08-01 03:14:44,565 - INFO -   ðŸŽ² Standard Gaussian Rate: 100.0%
2025-08-01 03:14:44,565 - INFO -   Train vs Eval Consistency: âœ… CONSISTENT (diff=0.564)
2025-08-01 03:14:44,565 - INFO - Running FIXED evaluation at step 150 (NO NOISE SCALING)...
2025-08-01 03:14:48,698 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 03:15:03,028 - INFO - FIXED Evaluation results:
2025-08-01 03:15:03,030 - INFO -   CLIP similarity: 0.2031
2025-08-01 03:15:03,030 - INFO -   Generated norm: 40.721
2025-08-01 03:15:03,030 - INFO -   Target norm: 25.856
2025-08-01 03:15:03,030 - INFO -   Norm ratio: 1.575
2025-08-01 03:15:03,030 - INFO -   Norm consistency: 0.425
2025-08-01 03:15:03,030 - INFO -   ðŸŽ² Standard Gaussian noise: True
2025-08-01 03:15:03,030 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:15:03,030 - INFO - Epoch 5 completed:
2025-08-01 03:15:03,031 - INFO -   Average loss: 0.261455
2025-08-01 03:15:03,031 - INFO -   Best loss: 0.261455
2025-08-01 03:15:03,031 - INFO -   Best similarity: 0.9144
2025-08-01 03:15:03,031 - INFO -   Steps in epoch: 1
2025-08-01 03:15:03,031 - INFO -   Epoch time: 22.8s
2025-08-01 03:15:03,031 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:15:03,031 - INFO -     Training target norm: 25.292
2025-08-01 03:15:03,031 - INFO -     Eval target norm: 25.856
2025-08-01 03:15:03,031 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:15:03,031 - INFO - Starting epoch 6/10
2025-08-01 03:15:07,059 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:15:07,340 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:15:07,340 - INFO - Epoch 6 completed:
2025-08-01 03:15:07,340 - INFO -   Average loss: 0.257998
2025-08-01 03:15:07,340 - INFO -   Best loss: 0.257998
2025-08-01 03:15:07,340 - INFO -   Best similarity: 0.9154
2025-08-01 03:15:07,340 - INFO -   Steps in epoch: 1
2025-08-01 03:15:07,340 - INFO -   Epoch time: 4.3s
2025-08-01 03:15:07,341 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:15:07,341 - INFO -     Training target norm: 25.292
2025-08-01 03:15:07,341 - INFO -     Eval target norm: 25.856
2025-08-01 03:15:07,341 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:15:07,341 - INFO - Starting epoch 7/10
2025-08-01 03:15:11,361 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:15:11,642 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:15:11,642 - INFO - Epoch 7 completed:
2025-08-01 03:15:11,642 - INFO -   Average loss: 0.248905
2025-08-01 03:15:11,642 - INFO -   Best loss: 0.248905
2025-08-01 03:15:11,642 - INFO -   Best similarity: 0.9187
2025-08-01 03:15:11,642 - INFO -   Steps in epoch: 1
2025-08-01 03:15:11,642 - INFO -   Epoch time: 4.3s
2025-08-01 03:15:11,643 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:15:11,643 - INFO -     Training target norm: 25.292
2025-08-01 03:15:11,643 - INFO -     Eval target norm: 25.856
2025-08-01 03:15:11,643 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:15:11,643 - INFO - Starting epoch 8/10
2025-08-01 03:15:15,664 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:15:15,947 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:15:15,948 - INFO - Epoch 8 completed:
2025-08-01 03:15:15,948 - INFO -   Average loss: 0.248810
2025-08-01 03:15:15,948 - INFO -   Best loss: 0.248810
2025-08-01 03:15:15,948 - INFO -   Best similarity: 0.9187
2025-08-01 03:15:15,948 - INFO -   Steps in epoch: 1
2025-08-01 03:15:15,948 - INFO -   Epoch time: 4.3s
2025-08-01 03:15:15,948 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:15:15,948 - INFO -     Training target norm: 25.292
2025-08-01 03:15:15,948 - INFO -     Eval target norm: 25.856
2025-08-01 03:15:15,948 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:15:15,948 - INFO - Starting epoch 9/10
2025-08-01 03:15:19,978 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:15:20,262 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:15:20,262 - INFO - Epoch 9 completed:
2025-08-01 03:15:20,262 - INFO -   Average loss: 0.236207
2025-08-01 03:15:20,262 - INFO -   Best loss: 0.236207
2025-08-01 03:15:20,262 - INFO -   Best similarity: 0.9230
2025-08-01 03:15:20,263 - INFO -   Steps in epoch: 1
2025-08-01 03:15:20,263 - INFO -   Epoch time: 4.3s
2025-08-01 03:15:20,263 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:15:20,263 - INFO -     Training target norm: 25.292
2025-08-01 03:15:20,263 - INFO -     Eval target norm: 25.856
2025-08-01 03:15:20,263 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:15:20,263 - INFO - Starting epoch 10/10
2025-08-01 03:15:24,324 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 03:15:24,612 - INFO - ðŸŽ‰ OVERFITTING TEST PASSED! Model can learn effectively with standard Gaussian noise.
2025-08-01 03:15:24,612 - INFO - Epoch 10 completed:
2025-08-01 03:15:24,612 - INFO -   Average loss: 0.236571
2025-08-01 03:15:24,612 - INFO -   Best loss: 0.236207
2025-08-01 03:15:24,612 - INFO -   Best similarity: 0.9230
2025-08-01 03:15:24,612 - INFO -   Steps in epoch: 1
2025-08-01 03:15:24,612 - INFO -   Epoch time: 4.3s
2025-08-01 03:15:24,613 - INFO -   ðŸ“Š Epoch Norm Analysis:
2025-08-01 03:15:24,613 - INFO -     Training target norm: 25.292
2025-08-01 03:15:24,613 - INFO -     Eval target norm: 25.856
2025-08-01 03:15:24,614 - INFO -     ðŸŽ² Noise: Î¼=-0.000460, Ïƒ=1.000469, standard=100.0%
2025-08-01 03:15:26,454 - INFO - Checkpoint saved: checkpoints/clip_repro_20250801_031250/checkpoint_step_155.pt
2025-08-01 03:15:26,454 - INFO - Running final FIXED evaluation (NO NOISE SCALING)...
2025-08-01 03:15:30,590 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 03:15:59,260 - INFO - ðŸ”§ FIXED Training completed (NO NOISE SCALING)!
2025-08-01 03:15:59,262 - INFO -   Total time: 175.6 seconds
2025-08-01 03:15:59,262 - INFO -   Total steps: 155
2025-08-01 03:15:59,262 - INFO -   Best loss: 0.236207
2025-08-01 03:15:59,262 - INFO -   Best CLIP similarity: 0.9230
2025-08-01 03:15:59,262 - INFO -   ðŸŽ² Standard Gaussian noise used throughout
2025-08-01 03:15:59,262 - INFO -   ðŸ”§ FIXED: Consistent evaluation and overfitting test
2025-08-01 03:15:59,262 - INFO -   ðŸ“Š WandB run: False
2025-08-01 03:15:59,262 - INFO - ðŸ“Š FINAL NORM ANALYSIS (NO NOISE SCALING):
2025-08-01 03:15:59,262 - INFO -   Training target norm: 25.292 Â± 0.000 (range: 25.292-25.292)
2025-08-01 03:15:59,262 - INFO -   Eval target norm: 26.029 Â± 0.618 (range: 25.292-26.921)
2025-08-01 03:15:59,262 - INFO -   Overfit target norm: 25.292
2025-08-01 03:15:59,262 - INFO -   ðŸŽ² FINAL Noise Stats: Î¼=-0.000460, Ïƒ=1.000469
2025-08-01 03:15:59,262 - INFO -   ðŸŽ² Standard Gaussian Rate: 100.0%
2025-08-01 03:15:59,262 - INFO -   Final consistency: âœ… CONSISTENT (diff=0.737)
2025-08-01 03:15:59,262 - INFO -   Final FIXED evaluation:
2025-08-01 03:15:59,262 - INFO -     CLIP similarity: 0.1727
2025-08-01 03:15:59,262 - INFO -     Generated norm: 40.043
2025-08-01 03:15:59,262 - INFO -     Target norm: 26.288
2025-08-01 03:15:59,263 - INFO -     Norm ratio: 1.523
2025-08-01 03:15:59,263 - INFO -     Norm consistency: 0.477
2025-08-01 03:15:59,263 - INFO -   Overfitting test: âœ… PASSED
2025-08-01 03:15:59,263 - INFO -     âœ… Model successfully learned with standard Gaussian noise!
2025-08-01 03:15:59,266 - INFO - 
==========================================================================================
2025-08-01 03:15:59,266 - INFO - ðŸŽ‰ FIXED BLIP3-o TRAINING COMPLETED!
2025-08-01 03:15:59,266 - INFO - ==========================================================================================
2025-08-01 03:15:59,266 - INFO - ðŸ“Š RESULTS SUMMARY:
2025-08-01 03:15:59,266 - INFO -   Duration: 175.6 seconds (2.9 minutes)
2025-08-01 03:15:59,266 - INFO -   Total steps: 155
2025-08-01 03:15:59,266 - INFO -   Best loss: 0.236207
2025-08-01 03:15:59,266 - INFO -   Best CLIP similarity: 0.9230
2025-08-01 03:15:59,266 - INFO -   ðŸ”§ FIXED version with consistent data and NO unwanted normalization
2025-08-01 03:15:59,266 - INFO -   ðŸŽ‰ EXCELLENT: Similarity >0.8 - All fixes worked perfectly!
2025-08-01 03:15:59,266 - INFO - ðŸ“Š FINAL FIXED EVALUATION:
2025-08-01 03:15:59,266 - INFO -   CLIP similarity: 0.1727
2025-08-01 03:15:59,266 - INFO -   Generated norm: 40.043
2025-08-01 03:15:59,266 - INFO -   Target norm: 26.288
2025-08-01 03:15:59,266 - INFO -   Norm ratio: 1.523
2025-08-01 03:15:59,266 - INFO -   Norm consistency: 0.477
2025-08-01 03:15:59,266 - INFO -   High quality (>0.7): 0.0%
2025-08-01 03:15:59,266 - INFO -   Very high quality (>0.8): 0.0%
2025-08-01 03:15:59,266 - INFO -   Excellent quality (>0.9): 0.0%
2025-08-01 03:15:59,266 - INFO -   âš ï¸  Norm consistency still needs work (ratio: 1.523)
2025-08-01 03:15:59,266 - INFO - ðŸ“Š ENHANCED NORM ANALYSIS:
2025-08-01 03:15:59,266 - INFO -   Training target norms: mean=25.292, std=0.000
2025-08-01 03:15:59,266 - INFO -     Range: [25.292, 25.292]
2025-08-01 03:15:59,266 - INFO -   Eval target norms: mean=26.029, std=0.618
2025-08-01 03:15:59,266 - INFO -     Range: [25.292, 26.921]
2025-08-01 03:15:59,266 - INFO -   Overfit target norm: 25.292
2025-08-01 03:15:59,266 - INFO -   ðŸŽ‰ EXCELLENT data consistency! (diff=0.737)
2025-08-01 03:15:59,267 - INFO - ðŸ§ª FIXED OVERFITTING TEST: âœ… PASSED
2025-08-01 03:15:59,267 - INFO -   Data source: eval_dataloader
2025-08-01 03:15:59,267 - INFO -    âœ… FIXED model can learn and memorize effectively!
2025-08-01 03:15:59,267 - INFO -    âœ… Architecture and data pipeline are working correctly!
2025-08-01 03:15:59,269 - INFO - ðŸ“ FIXED summary saved to checkpoints/clip_repro_20250801_031250/fixed_final_summary.json
2025-08-01 03:15:59,269 - INFO - ðŸ“ Model checkpoints saved to checkpoints/clip_repro_20250801_031250
2025-08-01 03:15:59,269 - INFO - ==========================================================================================
2025-08-01 03:15:59,269 - INFO - ðŸ”§ VERIFICATION CHECKLIST:
2025-08-01 03:15:59,269 - INFO -   âœ… Overfitting test uses same data source as evaluation
2025-08-01 03:15:59,270 - INFO -   âœ… Target norms should be consistent between training and eval
2025-08-01 03:15:59,270 - INFO -   âœ… NO normalization applied except for cosine similarity
2025-08-01 03:15:59,270 - INFO -   âœ… Raw embedding space preserved throughout pipeline
2025-08-01 03:15:59,270 - INFO -   âœ… Enhanced norm tracking shows data distribution
2025-08-01 03:15:59,270 - INFO -   âœ… Model can potentially achieve >0.8 similarity on overfitting test
2025-08-01 03:15:59,270 - INFO - ==========================================================================================
2025-08-01 03:15:59,270 - INFO - ðŸ”¬ DEBUGGING TIPS:
2025-08-01 03:15:59,270 - INFO -   â€¢ Check norm tracking logs for consistent target norms
2025-08-01 03:15:59,270 - INFO -   â€¢ Compare training vs eval target norm means (should be similar)
2025-08-01 03:15:59,270 - INFO -   â€¢ Look for 'CLIP norm=X.X' in shard loading logs
2025-08-01 03:15:59,270 - INFO -   â€¢ Verify overfitting test shows 'from evaluation data' message
2025-08-01 03:15:59,270 - INFO -   â€¢ Run norm analysis script: python debug_norm_analysis.py <embeddings_dir>
2025-08-01 03:15:59,270 - INFO - ==========================================================================================
