2025-07-28 13:21:24,784 - INFO - ğŸš€ Starting CLIP Reproduction with BLIP3-o DiT
2025-07-28 13:21:24,785 - INFO - ================================================================================
2025-07-28 13:21:24,785 - INFO - EXPERIMENT DETAILS:
2025-07-28 13:21:24,785 - INFO -   ğŸ“‹ Task: Reproduce clean CLIP embeddings from EVA embeddings
2025-07-28 13:21:24,785 - INFO -   ğŸ§  Model: BLIP3-o DiT with advanced architecture features
2025-07-28 13:21:24,785 - INFO -   ğŸ¯ Target: CLIP embeddings [B, N, 1024]
2025-07-28 13:21:24,785 - INFO -   ğŸ® Conditioning: EVA embeddings [B, N, 4096]
2025-07-28 13:21:24,785 - INFO -   ğŸŒŠ Method: Rectified Flow Matching
2025-07-28 13:21:24,785 - INFO -   ğŸš« Normalization: MINIMAL (only for evaluation similarity)
2025-07-28 13:21:24,785 - INFO - ================================================================================
2025-07-28 13:21:24,785 - INFO - ğŸ—ï¸ BLIP3-o ARCHITECTURE FEATURES:
2025-07-28 13:21:24,785 - INFO -   ğŸŒ 3D Rotary Position Embedding: âœ… ENABLED
2025-07-28 13:21:24,785 - INFO -   ğŸ¥ª Sandwich Normalization: âœ… ENABLED
2025-07-28 13:21:24,785 - INFO -   ğŸ” Grouped-Query Attention: âœ… ENABLED
2025-07-28 13:21:24,785 - INFO -   ğŸ“Š WandB Logging: âœ… ENABLED
2025-07-28 13:21:24,785 - INFO - ================================================================================
2025-07-28 13:21:24,785 - INFO - ğŸ“„ Updated file structure:
2025-07-28 13:21:24,785 - INFO -   â€¢ Model: blip3o_dit.py (âœ… 3D RoPE + Sandwich Norm)
2025-07-28 13:21:24,785 - INFO -   â€¢ Loss: blip3o_fm_loss.py
2025-07-28 13:21:24,785 - INFO -   â€¢ Dataset: blip3o_datasets.py
2025-07-28 13:21:24,785 - INFO -   â€¢ Trainer: blip3o_trainer.py (âœ… WandB Integration)
2025-07-28 13:21:24,785 - INFO -   â€¢ Config: blip3o_config.py
2025-07-28 13:21:24,786 - INFO - ================================================================================
2025-07-28 13:21:24,786 - INFO - Configuration:
2025-07-28 13:21:24,786 - INFO -   Model size: base
2025-07-28 13:21:24,786 - INFO -   Training mode: patch_only
2025-07-28 13:21:24,786 - INFO -   Embeddings dir: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-07-28 13:21:24,786 - INFO -   Output dir: ./checkpoints/clip_repro_20250728_132121
2025-07-28 13:21:24,786 - INFO -   Learning rate: 0.0005
2025-07-28 13:21:24,786 - INFO -   Batch size: 16
2025-07-28 13:21:24,787 - INFO -   Epochs: 10
2025-07-28 13:21:24,787 - INFO -   Max shards: 2
2025-07-28 13:21:24,787 - INFO -   ğŸ§ª OVERFITTING TEST: 20 samples
2025-07-28 13:21:24,787 - INFO -   Debug mode: False
2025-07-28 13:21:24,787 - INFO -   ğŸ“Š WandB project: blip3o-clip-reproduction
2025-07-28 13:21:24,787 - INFO - ================================================================================
2025-07-28 13:21:24,787 - INFO - ğŸ” Checking module availability...
2025-07-28 13:21:31,726 - INFO - âœ… CLIP DiT model loaded from src/modules/models/blip3o_dit.py
2025-07-28 13:21:31,736 - INFO - âœ… Flow matching loss loaded from src/modules/losses/blip3o_fm_loss.py
2025-07-28 13:21:33,184 - INFO - âœ… CLIP trainer loaded from src/modules/trainers/blip3o_trainer.py
2025-07-28 13:21:33,195 - INFO - âœ… CLIP datasets loaded from src/modules/datasets/blip3o_dataset.py
2025-07-28 13:21:33,199 - INFO - âœ… Configuration loaded from src/modules/config/blip3o_config.py
2025-07-28 13:21:33,199 - INFO - ğŸ‰ All CLIP reproduction components loaded successfully!
2025-07-28 13:21:33,199 - INFO - ğŸ‰ BLIP3-o CLIP reproduction modules fully initialized!
2025-07-28 13:21:33,199 - INFO - ğŸš« Using minimal normalization approach
2025-07-28 13:21:33,199 - INFO - ğŸ¯ Ready for EVA â†’ CLIP reproduction training
2025-07-28 13:21:33,199 - INFO - âœ… Using comprehensive modules system
2025-07-28 13:21:33,200 - INFO - ğŸ‰ All CLIP reproduction components loaded successfully!
2025-07-28 13:21:33,200 - INFO - ğŸ‰ All CLIP reproduction components loaded successfully!
2025-07-28 13:21:33,200 - INFO - âœ… Imported config from src.modules
2025-07-28 13:21:33,643 - INFO - Using GPU: NVIDIA H100
2025-07-28 13:21:33,643 - INFO - GPU Memory: 100.0 GB
2025-07-28 13:21:33,644 - INFO - ğŸ—ï¸ BLIP3-o Architecture Configuration:
2025-07-28 13:21:33,644 - INFO -   3D Rotary Position Embedding: âœ… Enabled
2025-07-28 13:21:33,644 - INFO -   Sandwich Normalization: âœ… Enabled
2025-07-28 13:21:33,644 - WARNING - Failed to import from blip3o_dit.py: No module named 'blip3o_dit'
2025-07-28 13:21:33,644 - INFO - âœ… Imported model from src.modules
2025-07-28 13:21:35,691 - INFO - BLIP3-o CLIP DiT model initialized with 249,339,136 parameters
2025-07-28 13:21:35,691 - INFO -   3D RoPE: True
2025-07-28 13:21:35,691 - INFO -   Sandwich Normalization: True
2025-07-28 13:21:35,691 - INFO -   Grid size: 16x16
2025-07-28 13:21:35,691 - INFO -   Hidden size: 768
2025-07-28 13:21:35,691 - INFO -   CLIP size: 1024
2025-07-28 13:21:35,691 - INFO - Creating base model for patch_only mode...
2025-07-28 13:21:35,956 - INFO - Model created with 249,339,136 parameters
2025-07-28 13:21:35,956 - INFO - Model moved to cuda
2025-07-28 13:21:35,956 - INFO - ğŸ” Architecture Validation:
2025-07-28 13:21:35,956 - INFO -   3D RoPE: âœ…
2025-07-28 13:21:35,956 - INFO -   Sandwich Norm: âœ…
2025-07-28 13:21:35,956 - INFO -   Grid Size: 16x16
2025-07-28 13:21:35,956 - INFO -   Grouped-Query Attention: 12/4
2025-07-28 13:21:35,956 - WARNING - Failed to import from blip3o_fm_loss.py: No module named 'blip3o_fm_loss'
2025-07-28 13:21:35,956 - INFO - âœ… Imported loss from src.modules
2025-07-28 13:21:35,957 - INFO - CLIP Flow Matching Loss initialized with noise scaling:
2025-07-28 13:21:35,957 - INFO -   Prediction type: velocity
2025-07-28 13:21:35,957 - INFO -   Flow type: rectified
2025-07-28 13:21:35,957 - INFO -   Adaptive noise scaling: True
2025-07-28 13:21:35,957 - INFO -   Debug mode: False
2025-07-28 13:21:35,957 - INFO - Flow matching loss created
2025-07-28 13:21:35,957 - WARNING - Failed to import from blip3o_datasets.py: No module named 'blip3o_datasets'
2025-07-28 13:21:35,957 - INFO - âœ… Imported dataset from src.modules
2025-07-28 13:21:35,957 - INFO - Creating CLIP reproduction dataloaders:
2025-07-28 13:21:35,957 - INFO -   Target: CLIP embeddings [B, N, 1024]
2025-07-28 13:21:35,957 - INFO -   Conditioning: EVA embeddings [B, N, 4096]
2025-07-28 13:21:35,957 - INFO -   Normalize: False
2025-07-28 13:21:35,957 - INFO -   ğŸ¯ COLLECT STATISTICS: True (for noise scaling)
2025-07-28 13:21:35,985 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-07-28 13:21:35,985 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-07-28 13:21:36,014 - INFO - Prepared 2 shard files
2025-07-28 13:21:36,014 - INFO - Using manifest for length estimation: 5,219 samples
2025-07-28 13:21:36,014 - INFO - CLIP Reproduction Dataset initialized:
2025-07-28 13:21:36,014 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-07-28 13:21:36,014 - INFO -   Mode: patch_only (256 tokens)
2025-07-28 13:21:36,014 - INFO -   TARGET: CLIP embeddings [B, N, 1024]
2025-07-28 13:21:36,014 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096]
2025-07-28 13:21:36,014 - INFO -   Normalize: False
2025-07-28 13:21:36,014 - INFO -   Shards: 2
2025-07-28 13:21:36,014 - INFO -   Estimated samples: 5,219
2025-07-28 13:21:36,014 - INFO -   ğŸ¯ COLLECT STATISTICS: True (for noise scaling)
2025-07-28 13:21:36,015 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-07-28 13:21:36,015 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-07-28 13:21:36,015 - INFO - Prepared 2 shard files
2025-07-28 13:21:36,015 - INFO - Using manifest for length estimation: 5,219 samples
2025-07-28 13:21:36,015 - INFO - CLIP Reproduction Dataset initialized:
2025-07-28 13:21:36,015 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-07-28 13:21:36,015 - INFO -   Mode: patch_only (256 tokens)
2025-07-28 13:21:36,015 - INFO -   TARGET: CLIP embeddings [B, N, 1024]
2025-07-28 13:21:36,015 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096]
2025-07-28 13:21:36,015 - INFO -   Normalize: False
2025-07-28 13:21:36,015 - INFO -   Shards: 2
2025-07-28 13:21:36,015 - INFO -   Estimated samples: 5,219
2025-07-28 13:21:36,015 - INFO -   ğŸ¯ COLLECT STATISTICS: False (for noise scaling)
2025-07-28 13:21:36,015 - INFO - CLIP reproduction dataloaders created successfully
2025-07-28 13:21:36,015 - INFO -   Training dataset length: 5,219
2025-07-28 13:21:36,016 - INFO -   Evaluation dataset length: 5,219
2025-07-28 13:21:40,595 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:21:40,683 - INFO -   ğŸ“Š Initial data statistics:
2025-07-28 13:21:40,684 - INFO -     CLIP norm: 26.319 Â± 2.018
2025-07-28 13:21:40,684 - INFO -     CLIP std: 0.979
2025-07-28 13:21:40,684 - INFO -     EVA norm: 43.667 Â± 1.968
2025-07-28 13:21:40,684 - INFO -     Samples seen: 2601
2025-07-28 13:21:40,684 - INFO - Dataloaders created
2025-07-28 13:21:40,684 - INFO -   Training batches: 326
2025-07-28 13:21:40,684 - INFO -   Evaluation available: True
2025-07-28 13:21:40,684 - INFO -   ğŸš« Normalization disabled in dataloaders
2025-07-28 13:21:40,685 - WARNING - Failed to import from blip3o_trainer.py: No module named 'blip3o_trainer'
2025-07-28 13:21:40,685 - INFO - âœ… Imported trainer from src.modules
2025-07-28 13:21:40,689 - INFO - Got exact dataloader length: 326
2025-07-28 13:21:40,690 - INFO - Optimizer and scheduler setup complete
2025-07-28 13:21:40,690 - INFO -   Total estimated steps: 3260
2025-07-28 13:21:40,690 - INFO -   Warmup steps: 100
2025-07-28 13:21:42,209 - INFO - âœ… WandB initialized: blip3o-clip-reproduction
2025-07-28 13:21:42,210 - INFO -    Run ID: 8pjjia7i
2025-07-28 13:21:42,210 - INFO -    Run URL: https://wandb.ai/Eva-Clip/blip3o-clip-reproduction/runs/8pjjia7i
2025-07-28 13:21:42,210 - INFO - Preparing overfitting test with 20 samples...
2025-07-28 13:21:46,767 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:21:46,823 - INFO - Overfitting test prepared with 16 samples
2025-07-28 13:21:46,824 - INFO - BLIP3-o CLIP Trainer initialized with noise scaling
2025-07-28 13:21:46,824 - INFO -   Device: cuda
2025-07-28 13:21:46,824 - INFO -   Learning rate: 0.0005
2025-07-28 13:21:46,824 - INFO -   Epochs: 10
2025-07-28 13:21:46,824 - INFO -   Estimated steps per epoch: 326
2025-07-28 13:21:46,824 - INFO -   Noise scale sync every: 10 steps
2025-07-28 13:21:46,824 - INFO -   Generation debug: False
2025-07-28 13:21:46,824 - INFO -   Overfit test: 20
2025-07-28 13:21:46,824 - INFO -   Mixed precision: True
2025-07-28 13:21:46,824 - INFO -   WandB logging: True
2025-07-28 13:21:46,824 - INFO -   ğŸ¯ FIXED: Proper noise scaling between training and inference
2025-07-28 13:21:46,825 - INFO - Trainer created with WandB integration
2025-07-28 13:21:46,825 - INFO -   ğŸ“Š WandB enabled: True
2025-07-28 13:21:46,825 - INFO -   ğŸ“Š WandB project: blip3o-clip-reproduction
2025-07-28 13:21:46,825 - INFO -   ğŸ“Š WandB run name: blip3o_base_patch_only_3drope_sandwich_20250728_132140
2025-07-28 13:21:46,825 - INFO -   ğŸ“Š WandB tags: ['blip3o', 'clip_reproduction', 'eva_conditioning', '3d_rope', 'sandwich_norm', 'overfit_test']
2025-07-28 13:21:46,827 - INFO - Configuration saved to checkpoints/clip_repro_20250728_132121/experiment_config.json
2025-07-28 13:21:46,827 - INFO - 
ğŸš€ Starting BLIP3-o training with advanced features...
2025-07-28 13:21:46,827 - INFO - Expected behavior:
2025-07-28 13:21:46,827 - INFO -   â€¢ Loss should decrease steadily
2025-07-28 13:21:46,827 - INFO -   â€¢ Velocity similarity should increase
2025-07-28 13:21:46,827 - INFO -   â€¢ CLIP similarity should improve during evaluation
2025-07-28 13:21:46,827 - INFO -   â€¢ Gradients should be non-zero and stable
2025-07-28 13:21:46,827 - INFO -   â€¢ Raw embeddings will be learned (no forced normalization)
2025-07-28 13:21:46,827 - INFO -   â€¢ 3D RoPE should provide spatial understanding
2025-07-28 13:21:46,827 - INFO -   â€¢ Sandwich normalization should improve gradient flow
2025-07-28 13:21:46,827 - INFO -   â€¢ WandB should log comprehensive metrics
2025-07-28 13:21:46,827 - INFO -   â€¢ OVERFITTING TEST: Should achieve >0.8 similarity on 20 samples
2025-07-28 13:21:46,827 - INFO - 
2025-07-28 13:21:46,828 - INFO - Starting CLIP reproduction training with noise scaling...
2025-07-28 13:21:46,829 - INFO -   Model parameters: 249,339,136
2025-07-28 13:21:46,829 - INFO -   Estimated training steps per epoch: 326
2025-07-28 13:21:46,829 - INFO -   Total estimated training steps: 3260
2025-07-28 13:21:46,829 - INFO -   ğŸ¯ NOISE SCALING: Adaptive noise scaling enabled
2025-07-28 13:21:46,829 - INFO -   ğŸ¯ SYNC FREQUENCY: Every 10 steps
2025-07-28 13:21:46,829 - INFO -   ğŸ“Š WandB logging: True
2025-07-28 13:21:46,829 - INFO -   OVERFITTING TEST MODE: Using 16 samples
2025-07-28 13:21:46,832 - INFO - Starting epoch 1/10
2025-07-28 13:21:51,279 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:21:56,803 - INFO - Step 10: Loss=1.809099, VelSim=0.3512 (fair), GradNorm=22571.548, LR=9.50e-05, NoiseScale=0.936 (ratio=1.220), PredNorm=12.936, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:21:57,013 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:00,766 - INFO - Step 20: Loss=1.733344, VelSim=0.3816 (fair), GradNorm=27565.555, LR=1.40e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=15.647, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:00,976 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:04,738 - INFO - Step 30: Loss=1.654649, VelSim=0.4106 (fair), GradNorm=13434.848, LR=1.85e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=17.021, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:04,949 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:08,716 - INFO - Step 40: Loss=1.592131, VelSim=0.4190 (fair), GradNorm=26302.642, LR=2.30e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=18.487, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:08,926 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:12,687 - INFO - Step 50: Loss=1.496413, VelSim=0.4074 (fair), GradNorm=56616.659, LR=2.75e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=20.375, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:12,689 - INFO - Running evaluation at step 50...
2025-07-28 13:22:17,773 - INFO - Loaded shard 1/2: 2646 samples
2025-07-28 13:22:25,214 - INFO - Evaluation results:
2025-07-28 13:22:25,215 - INFO -   CLIP similarity: 0.1921
2025-07-28 13:22:25,215 - INFO -   Generated norm: 32.608
2025-07-28 13:22:25,215 - INFO -   Target norm: 25.856
2025-07-28 13:22:25,215 - INFO -   Norm ratio: 1.261
2025-07-28 13:22:25,215 - INFO -   Noise scale used: 0.936
2025-07-28 13:22:25,428 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:29,112 - INFO - Step 60: Loss=1.368906, VelSim=0.4272 (fair), GradNorm=69414.602, LR=3.20e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=22.140, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:29,322 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:33,010 - INFO - Step 70: Loss=1.298870, VelSim=0.4747 (fair), GradNorm=97300.584, LR=3.65e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=20.832, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:33,219 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:36,898 - INFO - Step 80: Loss=1.296204, VelSim=0.4805 (fair), GradNorm=37247.156, LR=4.10e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=18.910, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:37,107 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:40,794 - INFO - Step 90: Loss=1.201092, VelSim=0.5246 (good), GradNorm=22060.138, LR=4.55e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=23.267, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:41,004 - INFO - Set model noise scale: 0.936
2025-07-28 13:22:44,745 - INFO - Step 100: Loss=1.077021, VelSim=0.5892 (good), GradNorm=34578.124, LR=5.00e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=25.084, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:22:44,745 - INFO - Running evaluation at step 100...
2025-07-28 13:22:49,326 - INFO - Loaded shard 1/2: 2646 samples
2025-07-28 13:22:56,528 - INFO - Evaluation results:
2025-07-28 13:22:56,528 - INFO -   CLIP similarity: 0.2141
2025-07-28 13:22:56,528 - INFO -   Generated norm: 36.347
2025-07-28 13:22:56,528 - INFO -   Target norm: 25.856
2025-07-28 13:22:56,529 - INFO -   Norm ratio: 1.406
2025-07-28 13:22:56,529 - INFO -   Noise scale used: 0.936
2025-07-28 13:22:56,738 - INFO - Set model noise scale: 0.936
2025-07-28 13:23:00,399 - INFO - Step 110: Loss=0.902465, VelSim=0.6730 (good), GradNorm=45081.200, LR=5.00e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=29.546, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:23:00,608 - INFO - Set model noise scale: 0.936
2025-07-28 13:23:04,317 - INFO - Step 120: Loss=0.728213, VelSim=0.7492 (good), GradNorm=39998.237, LR=5.00e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=31.697, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:23:04,528 - INFO - Set model noise scale: 0.936
2025-07-28 13:23:08,192 - INFO - Step 130: Loss=0.591258, VelSim=0.8046 (excellent), GradNorm=43562.502, LR=5.00e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=33.944, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:23:08,402 - INFO - Set model noise scale: 0.936
2025-07-28 13:23:12,083 - INFO - Step 140: Loss=0.454437, VelSim=0.8555 (excellent), GradNorm=22491.105, LR=5.00e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=36.244, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:23:12,291 - INFO - Set model noise scale: 0.936
2025-07-28 13:23:15,999 - INFO - Step 150: Loss=0.376314, VelSim=0.8829 (excellent), GradNorm=33066.077, LR=5.00e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=37.801, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:23:15,999 - INFO - Running evaluation at step 150...
2025-07-28 13:23:20,652 - INFO - Loaded shard 1/2: 2646 samples
2025-07-28 13:23:27,887 - INFO - Evaluation results:
2025-07-28 13:23:27,888 - INFO -   CLIP similarity: 0.2251
2025-07-28 13:23:27,888 - INFO -   Generated norm: 39.460
2025-07-28 13:23:27,888 - INFO -   Target norm: 25.856
2025-07-28 13:23:27,888 - INFO -   Norm ratio: 1.526
2025-07-28 13:23:27,888 - INFO -   Noise scale used: 0.936
2025-07-28 13:23:28,091 - INFO - Set model noise scale: 0.936
2025-07-28 13:23:29,997 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:23:29,998 - INFO - Epoch 1 completed:
2025-07-28 13:23:29,998 - INFO -   Average loss: 1.188601
2025-07-28 13:23:29,998 - INFO -   Best loss: 0.322895
2025-07-28 13:23:29,998 - INFO -   Best similarity: 0.9003
2025-07-28 13:23:29,998 - INFO -   Steps in epoch: 157
2025-07-28 13:23:29,998 - INFO -   Epoch time: 103.2s
2025-07-28 13:23:29,998 - INFO -   Current noise scale: 0.936
2025-07-28 13:23:29,998 - INFO - Starting epoch 2/10
2025-07-28 13:23:35,003 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:23:35,309 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:23:35,309 - INFO - Epoch 2 completed:
2025-07-28 13:23:35,309 - INFO -   Average loss: 0.316811
2025-07-28 13:23:35,309 - INFO -   Best loss: 0.316811
2025-07-28 13:23:35,309 - INFO -   Best similarity: 0.9023
2025-07-28 13:23:35,309 - INFO -   Steps in epoch: 1
2025-07-28 13:23:35,309 - INFO -   Epoch time: 5.3s
2025-07-28 13:23:35,309 - INFO -   Current noise scale: 0.936
2025-07-28 13:23:35,309 - INFO - Starting epoch 3/10
2025-07-28 13:23:39,915 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:23:40,218 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:23:40,218 - INFO - Epoch 3 completed:
2025-07-28 13:23:40,218 - INFO -   Average loss: 0.310624
2025-07-28 13:23:40,218 - INFO -   Best loss: 0.310624
2025-07-28 13:23:40,218 - INFO -   Best similarity: 0.9043
2025-07-28 13:23:40,218 - INFO -   Steps in epoch: 1
2025-07-28 13:23:40,218 - INFO -   Epoch time: 4.9s
2025-07-28 13:23:40,218 - INFO -   Current noise scale: 0.936
2025-07-28 13:23:40,219 - INFO - Starting epoch 4/10
2025-07-28 13:23:44,930 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:23:46,087 - INFO - Step 160: Loss=0.305557, VelSim=0.9059 (excellent), GradNorm=18224.918, LR=5.00e-04, NoiseScale=0.936 (ratio=1.220), PredNorm=38.201, TargetNorm=42.088 [OVERFIT TEST]
2025-07-28 13:23:46,087 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:23:46,087 - INFO - Epoch 4 completed:
2025-07-28 13:23:46,088 - INFO -   Average loss: 0.305557
2025-07-28 13:23:46,088 - INFO -   Best loss: 0.305557
2025-07-28 13:23:46,088 - INFO -   Best similarity: 0.9059
2025-07-28 13:23:46,088 - INFO -   Steps in epoch: 1
2025-07-28 13:23:46,088 - INFO -   Epoch time: 5.9s
2025-07-28 13:23:46,088 - INFO -   Current noise scale: 0.936
2025-07-28 13:23:46,088 - INFO - Starting epoch 5/10
2025-07-28 13:23:50,638 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:23:50,851 - INFO - Set model noise scale: 0.936
2025-07-28 13:23:50,952 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:23:50,952 - INFO - Epoch 5 completed:
2025-07-28 13:23:50,952 - INFO -   Average loss: 0.300729
2025-07-28 13:23:50,953 - INFO -   Best loss: 0.300729
2025-07-28 13:23:50,953 - INFO -   Best similarity: 0.9075
2025-07-28 13:23:50,953 - INFO -   Steps in epoch: 1
2025-07-28 13:23:50,953 - INFO -   Epoch time: 4.9s
2025-07-28 13:23:50,953 - INFO -   Current noise scale: 0.936
2025-07-28 13:23:50,953 - INFO - Starting epoch 6/10
2025-07-28 13:23:55,634 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:23:55,942 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:23:55,942 - INFO - Epoch 6 completed:
2025-07-28 13:23:55,943 - INFO -   Average loss: 0.297442
2025-07-28 13:23:55,943 - INFO -   Best loss: 0.297442
2025-07-28 13:23:55,943 - INFO -   Best similarity: 0.9085
2025-07-28 13:23:55,943 - INFO -   Steps in epoch: 1
2025-07-28 13:23:55,943 - INFO -   Epoch time: 5.0s
2025-07-28 13:23:55,943 - INFO -   Current noise scale: 0.936
2025-07-28 13:23:55,943 - INFO - Starting epoch 7/10
2025-07-28 13:24:00,540 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:24:00,847 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:24:00,847 - INFO - Epoch 7 completed:
2025-07-28 13:24:00,847 - INFO -   Average loss: 0.293877
2025-07-28 13:24:00,847 - INFO -   Best loss: 0.293877
2025-07-28 13:24:00,847 - INFO -   Best similarity: 0.9096
2025-07-28 13:24:00,847 - INFO -   Steps in epoch: 1
2025-07-28 13:24:00,848 - INFO -   Epoch time: 4.9s
2025-07-28 13:24:00,848 - INFO -   Current noise scale: 0.936
2025-07-28 13:24:00,848 - INFO - Starting epoch 8/10
2025-07-28 13:24:05,382 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:24:05,685 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:24:05,685 - INFO - Epoch 8 completed:
2025-07-28 13:24:05,685 - INFO -   Average loss: 0.291065
2025-07-28 13:24:05,685 - INFO -   Best loss: 0.291065
2025-07-28 13:24:05,685 - INFO -   Best similarity: 0.9105
2025-07-28 13:24:05,685 - INFO -   Steps in epoch: 1
2025-07-28 13:24:05,685 - INFO -   Epoch time: 4.8s
2025-07-28 13:24:05,685 - INFO -   Current noise scale: 0.936
2025-07-28 13:24:05,685 - INFO - Starting epoch 9/10
2025-07-28 13:24:10,068 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:24:10,375 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:24:10,375 - INFO - Epoch 9 completed:
2025-07-28 13:24:10,375 - INFO -   Average loss: 0.290628
2025-07-28 13:24:10,375 - INFO -   Best loss: 0.290628
2025-07-28 13:24:10,375 - INFO -   Best similarity: 0.9106
2025-07-28 13:24:10,375 - INFO -   Steps in epoch: 1
2025-07-28 13:24:10,375 - INFO -   Epoch time: 4.7s
2025-07-28 13:24:10,376 - INFO -   Current noise scale: 0.936
2025-07-28 13:24:10,376 - INFO - Starting epoch 10/10
2025-07-28 13:24:14,921 - INFO - Loaded shard 1/2: 2601 samples
2025-07-28 13:24:15,222 - INFO - ğŸ‰ OVERFITTING TEST PASSED! Model can learn effectively.
2025-07-28 13:24:15,222 - INFO - Epoch 10 completed:
2025-07-28 13:24:15,222 - INFO -   Average loss: 0.292545
2025-07-28 13:24:15,222 - INFO -   Best loss: 0.290628
2025-07-28 13:24:15,223 - INFO -   Best similarity: 0.9106
2025-07-28 13:24:15,223 - INFO -   Steps in epoch: 1
2025-07-28 13:24:15,223 - INFO -   Epoch time: 4.8s
2025-07-28 13:24:15,223 - INFO -   Current noise scale: 0.936
2025-07-28 13:24:17,943 - INFO - Checkpoint saved: checkpoints/clip_repro_20250728_132121/checkpoint_step_166.pt
2025-07-28 13:24:17,944 - INFO - Running final evaluation...
2025-07-28 13:24:22,366 - INFO - Loaded shard 1/2: 2646 samples
2025-07-28 13:24:38,360 - INFO - Training completed!
2025-07-28 13:24:38,360 - INFO -   Total time: 170.0 seconds
2025-07-28 13:24:38,360 - INFO -   Total steps: 166
2025-07-28 13:24:38,361 - INFO -   Best loss: 0.290628
2025-07-28 13:24:38,361 - INFO -   Best CLIP similarity: 0.9106
2025-07-28 13:24:38,361 - INFO -   ğŸ¯ NOISE SCALING: Final scale = 0.936
2025-07-28 13:24:38,361 - INFO -   ğŸ“Š WandB run: True
2025-07-28 13:24:38,361 - INFO -   Final evaluation:
2025-07-28 13:24:38,361 - INFO -     CLIP similarity: 0.2234
2025-07-28 13:24:38,361 - INFO -     Generated norm: 40.156
2025-07-28 13:24:38,361 - INFO -     Target norm: 26.288
2025-07-28 13:24:38,361 - INFO -     Norm ratio: 1.528
2025-07-28 13:24:38,361 - INFO -   Overfitting test: âœ… PASSED
2025-07-28 13:24:38,364 - INFO - 
================================================================================
2025-07-28 13:24:38,364 - INFO - ğŸ‰ BLIP3-o TRAINING COMPLETED!
2025-07-28 13:24:38,364 - INFO - ================================================================================
2025-07-28 13:24:38,364 - INFO - ğŸ“Š RESULTS SUMMARY:
2025-07-28 13:24:38,364 - INFO -   Duration: 171.5 seconds (2.9 minutes)
2025-07-28 13:24:38,364 - INFO -   Total steps: 166
2025-07-28 13:24:38,364 - INFO -   Best loss: 0.290628
2025-07-28 13:24:38,364 - INFO -   Best CLIP similarity: 0.9106
2025-07-28 13:24:38,364 - INFO -   ğŸš« Used minimal normalization approach
2025-07-28 13:24:38,364 - INFO -   ğŸŒ 3D RoPE: âœ…
2025-07-28 13:24:38,364 - INFO -   ğŸ¥ª Sandwich Norm: âœ…
2025-07-28 13:24:38,364 - INFO -   ğŸ“Š WandB: âœ…
2025-07-28 13:24:38,364 - INFO - ğŸ“Š FINAL EVALUATION:
2025-07-28 13:24:38,364 - INFO -   CLIP similarity: 0.2234
2025-07-28 13:24:38,364 - INFO -   High quality (>0.7): 0.0%
2025-07-28 13:24:38,364 - INFO -   Very high quality (>0.8): 0.0%
2025-07-28 13:24:38,364 - INFO -   Excellent quality (>0.9): 0.0%
2025-07-28 13:24:38,364 - INFO -   Samples evaluated: 32
2025-07-28 13:24:38,364 - INFO - ğŸ§ª OVERFITTING TEST: âœ… PASSED
2025-07-28 13:24:38,365 - INFO -    âœ… Model can learn and memorize - BLIP3-o architecture is working!
2025-07-28 13:24:38,365 - INFO - ğŸ—ï¸  BLIP3-o ARCHITECTURE ASSESSMENT:
2025-07-28 13:24:38,365 - INFO -    ğŸ‰ EXCELLENT: BLIP3-o DiT with 3D RoPE + Sandwich Norm working perfectly!
2025-07-28 13:24:38,365 - INFO - ğŸ“Š WandB Dashboard: Check your blip3o-clip-reproduction project for detailed metrics
2025-07-28 13:24:38,366 - INFO - ğŸ“ Final summary saved to checkpoints/clip_repro_20250728_132121/final_summary.json
2025-07-28 13:24:38,366 - INFO - ğŸ“ Model checkpoints saved to checkpoints/clip_repro_20250728_132121
2025-07-28 13:24:38,366 - INFO - ================================================================================
